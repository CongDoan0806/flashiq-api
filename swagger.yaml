openapi: 3.0.3
info:
  title: FlashIQ API
  description: API documentation for FlashIQ - English Flashcard Learning Application.
  version: 1.0.0
  contact:
    name: FlashIQ Team
servers:
  - url: http://localhost:3000/api/v1
    description: Local Development Server

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  
  schemas:
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        username:
          type: string
        email:
          type: string
          format: email
        avatar:
          type: string
          description: URL to avatar image
    
    Set:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        owner_id:
          type: string
          format: uuid
        is_public:
          type: boolean
        view_count:
          type: integer
          default: 0
        clone_count:
          type: integer
          default: 0
        card_count:
          type: integer
          description: Calculated field from backend
        created_at:
          type: string
          format: date-time
          
    Card:
      type: object
      properties:
        id:
          type: string
          format: uuid
        set_id:
          type: string
          format: uuid
        term:
          type: string
        definition:
          type: string
        example:
          type: string
        image_url:
          type: string

    StudyProgress:
      type: object
      properties:
        id:
          type: string
        user_id:
          type: string
        card_id:
          type: string
        score:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Learning score (0 to 1)
        last_reviewed:
          type: string
          format: date-time

tags:
  - name: Auth
    description: Authentication (Login, Register) - Module E
  - name: Users
    description: User Profile Management - Module E
  - name: Sets
    description: Flashcard Sets Management - Module A & D
  - name: Cards
    description: Card Management within Sets - Module A
  - name: Study
    description: Learning & Quiz Logic - Module B
  - name: AI & Tools
    description: AI features and Dictionary - Module C

paths:
  # ================= MODULE E: ACCOUNT MANAGEMENT =================
  /auth/register:
    post:
      tags: [Auth]
      summary: Register a new user (E.01)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [username, email, password]
              properties:
                username: { type: string }
                email: { type: string, format: email }
                password: { type: string, minLength: 6 }
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  token: { type: string }
                  user: { $ref: '#/components/schemas/User' }

  /auth/login:
    post:
      tags: [Auth]
      summary: Login user (E.02)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string }
                password: { type: string }
      responses:
        '200':
          description: Login successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken: { type: string }
                  refreshToken: { type: string }

  /users/me:
    get:
      tags: [Users]
      summary: Get current user profile (E.03)
      security: [{ bearerAuth: [] }]
      responses:
        '200':
          description: User profile
          content: 
            application/json:
              schema: { $ref: '#/components/schemas/User' }
    put:
      tags: [Users]
      summary: Update user profile (E.04)
      security: [{ bearerAuth: [] }]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                username: { type: string }
                avatar: { type: string }
      responses:
        '200':
          description: Updated successfully

  # ================= MODULE A: SET MANAGEMENT =================
  /sets:
    post:
      tags: [Sets]
      summary: Create a new Set (A.01)
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [title]
              properties:
                title: { type: string }
                description: { type: string }
                is_public: { type: boolean, default: false }
      responses:
        '201':
          description: Set created
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Set' }

  /sets/my-sets:
    get:
      tags: [Sets]
      summary: Get Dashboard Sets (A.02)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: query
          name: page
          schema: { type: integer, default: 1 }
        - in: query
          name: limit
          schema: { type: integer, default: 10 }
      responses:
        '200':
          description: List of user's sets
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Set' }

  /sets/{id}:
    get:
      tags: [Sets]
      summary: Get Set details by ID
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Set details
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Set' }
    put:
      tags: [Sets]
      summary: Update Set info (A.01 Edit)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                title: { type: string }
                description: { type: string }
                is_public: { type: boolean }
      responses:
        '200':
          description: Set updated
    delete:
      tags: [Sets]
      summary: Delete Set
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Set deleted

  /sets/search:
    get:
      tags: [Sets]
      summary: Search Public Sets (D.01)
      parameters:
        - in: query
          name: q
          schema: { type: string }
          description: Keyword to search in title
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Set' }

  /sets/{id}/clone:
    post:
      tags: [Sets]
      summary: Clone a Set to my library (D.02)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '201':
          description: Set cloned successfully
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Set' }

  # ================= MODULE A (Permissions) =================
  /sets/{id}/access:
    get:
      tags: [Sets]
      summary: Get access list for a Set (A.06)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: List of users with access
          content:
             application/json:
               schema:
                 type: array
                 items:
                   type: object
                   properties:
                      user_id: { type: string }
                      permission: { type: string, enum: [viewer, editor] }

  /sets/{id}/access/users:
    post:
      tags: [Sets]
      summary: Invite user to Set (A.06)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [email, permission]
              properties:
                email: { type: string }
                permission: { type: string, enum: [viewer, editor] }
      responses:
        '200':
          description: Invitation sent/Access granted

  # ================= MODULE A (Cards) =================
  /sets/{id}/cards:
    get:
      tags: [Cards]
      summary: Get all cards in a Set (For Study B.01)
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: List of cards
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Card' }
    post:
      tags: [Cards]
      summary: Add single card to Set (A.03)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [term, definition]
              properties:
                term: { type: string }
                definition: { type: string }
                example: { type: string }
      responses:
        '201':
          description: Card created

  /sets/{id}/cards/bulk:
    post:
      tags: [Cards]
      summary: Bulk Import Cards (A.05)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                type: object
                properties:
                  term: { type: string }
                  definition: { type: string }
      responses:
        '201':
          description: Multiple cards created

  /cards/{cardId}:
    put:
      tags: [Cards]
      summary: Update a Card (A.03)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: cardId
          required: true
          schema: { type: string }
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Card'
      responses:
        '200':
          description: Card updated
    delete:
      tags: [Cards]
      summary: Delete a Card (A.03)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: cardId
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Card deleted

  # ================= MODULE B: STUDY & PROGRESS =================
  /sets/{id}/quiz:
    get:
      tags: [Study]
      summary: Get Quiz questions (B.02 - BE Logic)
      description: Returns cards with generated detractors (wrong answers) for multiple choice.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: List of quiz items
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    question_card: { $ref: '#/components/schemas/Card' }
                    options: 
                      type: array
                      items: { type: string }
                      description: Array of 4 definitions (1 correct, 3 wrong)

  /study-records:
    post:
      tags: [Study]
      summary: Save study progress (B.05)
      security: [{ bearerAuth: [] }]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                set_id: { type: string }
                results:
                  type: array
                  items:
                    type: object
                    properties:
                      card_id: { type: string }
                      is_correct: { type: boolean }
      responses:
        '200':
          description: Progress saved

  /sets/{id}/study-records:
    get:
      tags: [Study]
      summary: Get progress for a Set (B.05)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Progress status
          content:
            application/json:
              schema:
                type: object
                properties:
                  studyRecords:
                    type: array
                    items:
                      $ref: '#/components/schemas/StudyRecord'

  # ================= MODULE C: AI & TOOLS =================
  /ai/generate-story:
    post:
      tags: [AI & Tools]
      summary: Generate story from vocabulary (C.01)
      security: [{ bearerAuth: [] }]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                list_words:
                  type: array
                  items: { type: string }
      responses:
        '200':
          description: AI generated story
          content:
            application/json:
              schema:
                type: object
                properties:
                  story: { type: string }
                  highlighted_words: { type: array, items: { type: string } }

  /dictionary/lookup:
    get:
      tags: [AI & Tools]
      summary: Auto-fill suggestion (A.04)
      parameters:
        - in: query
          name: term
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Dictionary suggestion
          content:
            application/json:
              schema:
                type: object
                properties:
                  term: { type: string }
                  definition: { type: string }
                  example: { type: string }